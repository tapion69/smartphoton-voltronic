name: Voltronic + Node-RED (Serial, Plug&Play)
version: "0.4.3"
slug: voltronic_nodered_serial
description: >
  Node-RED intégré. Lecture Voltronic via ports série directement dans Node-RED
  (QPIGS + QPIGS2) et publication MQTT. Configuration plug & play via l’UI de l’add-on.

arch:
  - amd64
  - aarch64
  - armv7
  - armhf
  - i386

startup: services
boot: auto
init: false

# Ingress (recommandé)
ingress: true
ingress_port: 1880
panel_icon: mdi:solar-power
webui: "[PROTO:ssl]://[HOST]:[PORT:1880]"

# IMPORTANT:
# On remet ports mais en "null" => pas exposé par défaut,
# mais le système Node-RED/NGINX de l'image ne plante plus.
ports:
  1880/tcp: null
ports_description:
  1880/tcp: Node-RED (accès direct optionnel)

uart: true
usb: true

services:
  - mqtt:need

options:
  mqtt_host: core-mosquitto
  mqtt_port: 1883
  mqtt_username: ""
  mqtt_password: ""
  mqtt_topic_prefix: voltronic
  poll_interval_s: 5
  reset_flows: false

  inverters:
    - name: inv1
      enabled: true
      port: /dev/serial/by-id/CHANGE-ME
      baudrate: 2400
    - name: inv2
      enabled: false
      port: /dev/serial/by-id/CHANGE-ME
      baudrate: 2400
    - name: inv3
      enabled: false
      port: ""
      baudrate: 2400

schema:
  mqtt_host: str
  mqtt_port: int
  mqtt_username: str
  mqtt_password: password
  mqtt_topic_prefix: str
  poll_interval_s: int
  reset_flows: bool
  inverters:
    - name: str
      enabled: bool
      port: str
      baudrate: int

devices: []
