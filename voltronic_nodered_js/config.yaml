name: Voltronic + Node-RED (Serial, Plug&Play)
version: "0.4.1"
slug: voltronic_nodered_serial
description: >
  Node-RED intégré. Lecture Voltronic via ports série directement dans Node-RED
  (QPIGS + QPIGS2) et publication MQTT. Configuration plug & play via l’UI de l’add-on.

arch:
  - amd64
  - aarch64
  - armv7
  - armhf
  - i386

startup: services
boot: auto
init: false

ingress: true
ingress_port: 1880
panel_icon: mdi:solar-power

# Accès direct (dev) : http://IP_HA:1880
ports:
  1880/tcp: 1880
ports_description:
  1880/tcp: Node-RED (éditeur)

uart: true
usb: true

services:
  - mqtt:need

options:
  mqtt_host: core-mosquitto
  mqtt_port: 1883
  mqtt_username: ""
  mqtt_password: ""
  mqtt_topic_prefix: voltronic
  poll_interval_s: 5
  reset_flows: false

  inverters:
    - name: inv1
      enabled: true
      port: /dev/serial/by-id/CHANGE-ME
      baudrate: 2400
    - name: inv2
      enabled: false
      port: /dev/serial/by-id/CHANGE-ME
      baudrate: 2400
    - name: inv3
      enabled: false
      port: /dev/serial/by-id/CHANGE-ME
      baudrate: 2400

schema:
  mqtt_host: str
  mqtt_port: int
  mqtt_username: str
  mqtt_password: password
  mqtt_topic_prefix: str
  poll_interval_s: int
  reset_flows: bool

  inverters:
    - name: str
      enabled: bool
      port: str
      baudrate: int

# On laisse HA exposer les devices USB/serial automatiquement (usb: true / uart: true)
# Ne pas figer /dev/ttyUSBx ici pour éviter les problèmes selon le matériel.
devices: []
